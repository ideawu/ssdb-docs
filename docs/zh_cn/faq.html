<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>SSDB - FAQ - 常见问题</title>
	<meta name="keywords" content="SSDB, SSDB 文档, LevelDB, Redis, LevelDB Server, zset" />
	<meta name="description" content="SSDB 是一个高性能 NoSQL 数据库, 使用 LevelDB 作为存储引擎, 支持 Redis 协议." />
	<link href="./../css/bootstrap.min.css" rel="stylesheet" />
	<link href="./../css/style.css" rel="stylesheet" />
</head>
<body>




<!-- Fixed navbar -->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<a class="navbar-brand" href="http://ssdb.io/zh_cn/">SSDB</a>
		</div>
		<div class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
				<li class="divider-vertical"></li>
				<li>
					<a href="http://ssdb.io/zh_cn/">
						<i class="glyphicon glyphicon-home"></i> 首页
					</a>
				</li>
				<li class="divider-vertical"></li>
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<i class="glyphicon glyphicon-share-alt"></i> GitHub <b class="caret"></b>
					</a>
					<ul class="dropdown-menu">
						<li><a target="_blank" href="https://github.com/ideawu/ssdb">源码</a></li>
						<li><a target="_blank" href="https://github.com/ideawu/ssdb-docs">文档</a></li>
					</ul>
				</li>
				<li class="divider-vertical"></li>
				<li class="dropdown active">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<i class="glyphicon glyphicon-list"></i> 文档 <b class="caret"></b>
					</a>
					<ul class="dropdown-menu">
						<li><a href="./../zh_cn/index.html">文档首页</a></li>
						<li class="divider"></li>
						<li><a href="./../zh_cn/faq.html">FAQ - 常见问题</a></li>
						<li><a href="./../zh_cn/ssdb-cli.html">ssdb-cli命令行</a></li>
						<li><a href="./../zh_cn/install.html">安装</a></li>
						<li><a href="./../zh_cn/commands/index.html">命令</a></li>
						<li><a href="./../zh_cn/config.html">配置</a></li>
						<li><a href="./../zh_cn/clients.html">客户端 SDK</a></li>
						<li><a href="./../zh_cn/protocol.html">SSDB 网络协议</a></li>
						<li><a href="./../zh_cn/index.html">更多...</a></li>
						<li class="divider"></li>
						<li><a href="./../zh_cn/php/index.html">PHP API 文档</a></li>
						<li><a href="./../cpp/index.html">C++ API 文档(英文)</a></li>
						<li><a href="./../java/index.html">Java API 文档(英文)</a></li>
						<li><a href="./../go/index.html">Go API 文档(英文)</a></li>
						<li class="divider"></li>
						<li><a href="https://github.com/ideawu/ssdb-docs/tree/master/pdf" target="_blank">SSDB 入门基础</a></li>
					</ul>
				</li>
				<li class="divider-vertical"></li>
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<i class="glyphicon glyphicon-user"></i> 讨论 <b class="caret"></b>
					</a>
					<ul class="dropdown-menu">
						<li><a href="https://github.com/ideawu/ssdb/issues">Issue Tracker</a></li>
						<li><a href="http://www.ideawu.net/blog/category/ssdb">博客</a></li>
						<li><a href="./../zh_cn/users.html">用户案例</a></li>
					</ul>
				</li>
			</ul>


			<ul class="nav navbar-nav navbar-right" style="margin-top: 9px;">
				<div class="btn-group">
					<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
						当前语言: 简体中文
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu">
						<li><a href="#" onclick="set_lang('en');">English</a></li>
						<li><a href="#" onclick="set_lang('zh_cn');">简体中文</a></li>
					</ul>
				</div>
			</ul>
			<script>
			function set_lang(lang){
				var url = location.href.replace(/lang=\w+&?/g, '').replace(/\?+$/, '');
				var ps = url.split('/');
				var index = ps.indexOf('docs');
				if(lang == 'en' && ps[index + 1] == 'zh_cn'){
					ps.splice(index + 1, 1);
				}else if(lang == 'zh_cn' && ps[index + 1] != 'zh_cn'){
					ps.splice(index + 1, 0, 'zh_cn');
				}else{
					return false;
				}
				url = ps.join('/');
				location.href = url;
				return false;
			}
			</script>

		</div><!--/.nav-collapse -->
	</div>
</div>



<div class="container">

<h1 id="faq-">FAQ - 常见问题</h1>
<ul>
<li><strong>问: 这里没有我想问的问题和答案, 我应该怎么办?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 我推荐所有人通过学习文档和使用自己大脑思考来回答自己的问题.  </p>
<p>如果你经过学习文档, 并且进行充分思考后, 仍然无法得到答案, 你可以到 Github 上提 issue.  </p>
<p>注意, 作为一个技术产品的用户, 一个互联网工作者, 甚至是一个程序员, 你应该学会基本的提问技能. 如果你的提问没有得到回答, 那么责任不在被问者, 而在于你自己, 你自己没有<strong>像个正常的技术人那样正确地提问</strong>.</p>
</blockquote>
<h2 id="_1">运维</h2>
<hr />
<ul>
<li><strong>问: 如何设置 SSDB 的内存占用上限?</strong> </li>
</ul>
<blockquote>
<p><strong>答: 很抱歉, SSDB 设置指定内存占用上限. 在文档 <a href="http://ssdb.io/docs/zh_cn/config.html">http://ssdb.io/docs/zh_cn/config.html</a> 介绍了内存相关的内容, 你可以看看.</strong> </p>
</blockquote>
<ul>
<li><strong>问: 我在进行压测(或者导数据), 起了1000个线程(或进程)来写数据, 为什么隔一会就会阻塞?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 如果你在短时间大量写数据(例如压测, 导几十G的数据), 就会如此. 设计如此, 你无法改变, 只能规避. 规避的方法是自己减慢导数据的速度, 同时在连接时, 设置更大的超时时间. 另外, 你还可以更换成性能更快的硬盘.</p>
</blockquote>
<ul>
<li><strong>问: 为什么我在本机可以访问 SSDB 服务器, 在其它机器却不能呢? 提示 Connection refused.</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 默认的配置文件基于安全考虑, 只开放给本机访问. 如果你想开放给网络上的其它 IP 访问, 请按文档 <a href="http://ssdb.io/docs/zh_cn/config.html">http://ssdb.io/docs/zh_cn/config.html</a> 修改配置.</p>
</blockquote>
<ul>
<li><strong>问: 为什么并发数上不去? 服务器报错 Too many open files, 客户端报错 Connection reset by peer.</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 请参考文档 <a href="http://ssdb.io/docs/zh_cn/config.html">http://ssdb.io/docs/zh_cn/config.html</a> 进行配置.</p>
</blockquote>
<ul>
<li><strong>问: 我把一个, 两个, 或者所有的 key 都删除了, 为什么 SSDB 占用的内存和磁盘空间并没有释放?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> SSDB 有自己策略来决定何时释放或者是否释放内存和硬盘占用, 你不能要求 SSDB <em>立即或者在未来某个时间, 或者基于某个条件</em> 释放这些空间. 而且, 即使数据库清空了, SSDB 仍然会保留一些信息, 因此仍然占用部分硬盘空间. 你不应该关心这个问题.</p>
</blockquote>
<ul>
<li><strong>问: 我用 info 命令查到 dbsize 是 1G, 为什么用系统的 du 命令查看, 却占用 2G 空间呢?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 注意, dbsize 是参考值, 和实际相比可能差距比较大, 应以 data 目录为准. 另外, SSDB 还会产生日志文件占用硬盘空间, 你可以根据文档中的相关内容删除不用的日志文件.</p>
</blockquote>
<ul>
<li><strong>问: 为什么 SSDB 偶尔会使用 100% CPU?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> SSDB <strong>偶尔</strong>使用 100% CPU 是完全<strong>正常的</strong>, 请不要大惊小怪. 这是因为 SSDB/LevelDB 在进行数据库整理(Compaction)操作, 持续的时间一般随着数据变大而变长, 一般只持续数秒.</p>
</blockquote>
<ul>
<li><strong>问: 为什么 SSDB 偶尔会使用较多磁盘 IO?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> SSDB <strong>偶尔</strong>使用较多磁盘 IO 是完全<strong>正常的</strong>, 请不要大惊小怪. 这是因为 SSDB/LevelDB 在进行数据库整理(Compaction)操作, 持续的时间一般随着数据变大而变长, 一般只持续数秒.</p>
</blockquote>
<ul>
<li><strong>问: 为什么 SSDB 偶尔会使用较多内存空间, 然后又降下来?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> SSDB 使用的内存空间是变动的, 可能忽高忽低. 使用的内存空间的上限在文档 <a href="http://ssdb.io/docs/zh_cn/config.html">http://ssdb.io/docs/zh_cn/config.html</a> 中有描述.</p>
</blockquote>
<ul>
<li><strong>问: Compaction 时服务会有稍微变慢, 我能设定 Compaction 执行的时间吗?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 很遗憾, 你不能设定 Compaction 在何时执行, SSDB/LevelDB 有自己策略和机制, 决定何时应该进行 Compaction. 根据大多数用户的使用反馈, Compaction 对服务没有任何影响.</p>
</blockquote>
<ul>
<li><strong>问: 我原来的配置文件中没有打开压缩选项(compression: no), 我能中途把 compression 改为 yes 吗?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 是的, 你可以在任何时候修改 compression 选项, 只要你重启 ssdb-server, 新的修改就能生效. 更改后, 原来的数据依然兼容, 不会有任何问题.</p>
</blockquote>
<ul>
<li><strong>问: 我开启了压缩选项, 但 SSDB 的硬盘占用并没有变小, 这是怎么回事?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 无论你开启或者关闭压缩选项, 只要重启后, 新的选项就已经生效了. 但是, 新的选项不一定立即影响原来的旧数据, SSDB 会在合适的时候将新选项应用于旧数据, 你无法控制这一点.</p>
</blockquote>
<ul>
<li><strong>问: 我的 SSDB 实例莫名其妙就退出了, 请问是什么原因?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 进程莫名退出, 一般是如下原因:</p>
<ol>
<li>max open files配置, 参见<a href="http://ssdb.io/docs/zh_cn/config.html">配置相关文档</a></li>
<li>硬件内存不足, 操作系统内核kill掉进程, <code>cat /var/log/messages | grep 'Out of'</code></li>
<li>程序bug</li>
<li>其它的</li>
</ol>
</blockquote>
<h2 id="_2">命令和用法</h2>
<hr />
<ul>
<li><strong>问: 有命令可以知道 SSDB 中存储的 key 总数吗?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 如果你想统计的是 KV 的数量, 那么, 在一开始时, 你就要把所有 KV 都放在同一个 HASH 中, 然后通过 <a href="./commands/hsize.html">hsize</a> 命令就可以得到 key 的数量了. 如果一开始你没有这么做, 或者你想统计 KV 以外的数量, 那么答案很简单 - 没有这样的单个命令(除非你自己写脚本遍历统计).</p>
</blockquote>
<ul>
<li><strong>问: SSDB 支持 key 查找吗? 支持通配符 * 模糊查找吗?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> SSDB 支持, 且<strong>仅</strong>支持<strong>前缀区间</strong>查找, 也就是类似<code>a*</code>这样的查找, 而不支持 <code>*a</code>, <code>*a*</code> 或者其它的模糊查找. 具体用法请参见命令: <a href="./commands/scan.html">scan</a>, <a href="./commands/hlist.html">hlist</a>, <a href="./commands/keys.html">keys</a>, <a href="./commands/hkeys.html">hkeys</a>, <a href="./commands/hscan.html">hscan</a>, <a href="./commands/zlist.html">zlist</a>, <a href="./commands/zkeys.html">zkeys</a>, <a href="./commands/zscan.html">zscan</a>, <a href="./commands/qlist.html">qlist</a> 的文档.</p>
<p><strong>注意, 这些命令都要求你省略 <code>*</code> 号!</strong></p>
<p><strong>注意, 区间搜索的意思是, 只要比下限大同时比上限小, 即使不是指定前缀, 也会返回!</strong></p>
</blockquote>
<ul>
<li><strong>问: SSDB 不支持 sets 集合吗? Redis 的 sadd, sdiff 等求交集, 并集命令我都用不了了?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> SSDB 不支持 sets, 以后也不太可能支持, 因为有替代方案. 你可以用 hash 来替代 sets, 因为一个 hash 的 key 是唯一的, 可以实现集合的特性. 至于交集, 并集等操作, 你只能自己实现. 例如, 求交集, 你可以遍历第一个 hash 的 key, 然后和第二个 hash 对比, 把结果存入第三个 hash.</p>
</blockquote>
<ul>
<li><strong>问: 我的 key 是数字, 为什么在 SSDB 里不是按数字大小排序的?</strong> </li>
</ul>
<blockquote>
<p><strong>答:</strong> 非常多的人在这里遇到不解, 这主要是没有深刻意识到, SSDB 是按 key 的字节顺序排序(字符串比较顺序), 我们平常认为 2 小于 100, 但是, 如果是字符串, 2 是大于 100 的, 因为字符串比较顺序是从左到左逐个字节进行比较.</p>
<p>为了达到你想要的效果, 你可以给数字加上 0 作为前缀, 补齐为固定长度的字符串, 例如把 2 变为 002, 那么 002 就小于 100, 符合你的预期. 一般来说, 要根据你的具体情况选择要补齐的最终长度.</p>
</blockquote>
<ul>
<li><strong>问: 我知道一个 key, 怎么知道这个 key 的类型? 也就是说, 有没有 Redis 那样的 type 命令?</strong> </li>
</ul>
<blockquote>
<p><strong>答:</strong> 注意, 这是 SSDB 和 Redis 的关键区别. 对于 SSDB 来说, 需要先区分数据类型, 然后再取名字(key). 也就是说, 不同类型的 key 是可以相同的. 所以, 你必须先知道类型, 才能知道 key. 如果你知道 key 而不知道类型, 说明你弄错了.</p>
</blockquote>
<ul>
<li><strong>问: 如何遍历整个 SSDB 数据库?</strong></li>
</ul>
<blockquote>
<p><strong>答: 见 <a href="https://github.com/ideawu/ssdb/blob/dev/tools/ssdb-iterate.php">https://github.com/ideawu/ssdb/blob/dev/tools/ssdb-iterate.php</a></strong> </p>
</blockquote>
<h2 id="_3">配置</h2>
<hr />
<ul>
<li><strong>问: 我用 Twemproxy 配置 SSDB 做负载均衡和集群, 但是当我用 ssdb-cli 连接 Twemproxy 时, 会报错, 为什么?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 因为 Twemproxy 不支持 SSDB 网络协议, 所以, 你只能使用 redis-cli 连接 Twemproxy. 注意, 你可以用 ssdb-cli 或者 redis-cli 连接 SSDB, 那是因为 SSDB 支持两种协议, 而 Twemproxy 只支持一种.</p>
</blockquote>
<ul>
<li><strong>问: 如何在一台机器上部署多个 SSDB 实例?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 每一个实例使用不同的配置文件进行启动, 而且, 配置文件里的 <code>work_dir</code> <code>server.port</code> 不能相同, 也就是每个实例的数据库存储路径, 以及监听端口. 如果 <code>pidfile</code> <code>logger.output</code> 使用的是绝对路径, 也要保证不能相同, 如果是相对路径, 由不需要, 因为默认跟随 <code>work_dir</code> 而不同了.</p>
</blockquote>
<h2 id="_4">主从同步</h2>
<hr />
<ul>
<li><strong>问: 对于多主, 或者主从集群, 如何恢复数据?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 对于多主, 或者主从集群, 恢复数据时以及集群的维度来恢复. 具体步骤是:</p>
<ol>
<li>部署一个空数据的集群(也就是说, 所有节点必须不包含任何数据)</li>
<li>把备份的数据导入集群中的一台master(如有多master, 也只一台)</li>
</ol>
</blockquote>
<ul>
<li><strong>问: 我想给主从集群新加入一台新的从节点(slave), 应该如何操作?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 方法有两种, 根据你的情况选择:</p>
<ol>
<li>启动一台空的节点, 在启动前, 配置其指向 master 即可. 这种方案最简单.</li>
<li>这种方案比较复杂, 你需要非常小心进行, 不要操作的时候和你的理解出现偏差! 这种方案是, 选择原来的一个 slave 节点, 停止它. 然后将这个节点的 meta data 两个目录连同配置文件复制到新机器, 然后启动新节点.</li>
</ol>
</blockquote>
<ul>
<li><strong>问: 如何快速的建立一个新的从节点(Slave)?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 建立新的从节点的速度，无法突破硬件的物理限制，这个限制主要是网络带宽和硬盘性能。在无法突破限制的前提下，有一种特殊的方法可尝试:</p>
<ol>
<li>在 master 相同的机器上，建立一个新的 slave.</li>
<li>把刚刚建好，已达到 SYNC 状态的 slave 停止，然后 scp 实例的目录(包括全部配置文件和数据文件)到新的机器.</li>
<li>在新机器启动 slave.</li>
</ol>
</blockquote>
<ul>
<li><strong>问: 我的 master 占用的硬盘空间是 100G, 但 slave 只占用 30G, 是不是有问题?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 主和从占用的硬盘空间不一致, 甚至相差很多, 不能得出有问题的结论. 如果你认为有问题, 你需要通过硬盘占用之外的其它信息来发现问题.</p>
</blockquote>
<ul>
<li><strong>问: 我 Bla bla bla 说了一堆废话, 为什么主从没有同步?</strong></li>
</ul>
<blockquote>
<p><strong>答:</strong> 确定主从是否同步的<strong>唯一</strong>方法是:</p>
<p><a href="http://ssdb.io/docs/zh_cn/replication.html">http://ssdb.io/docs/zh_cn/replication.html</a> 执行 info 命令, 判断 binlogs.max_seq 和 replication.client.last_seq 是否相等.</p>
</blockquote>
<ul>
<li><strong>问: 我有双主: A 和 B, 如果我同时往 A 和 B 上更新同一个 key...</strong> </li>
</ul>
<blockquote>
<p><strong>答:</strong> 停! SSDB 禁止你这么做! 你不能往多个节点写同一个 key, 你必须自己将 key 哈希到唯一的一个节点上, 保证对这个 key 的操作只会永远落在这个节点上.</p>
</blockquote>
<ul>
<li><strong>问: </strong> </li>
</ul>
<blockquote>
<p><strong>答:</strong> </p>
</blockquote>
<!-- #############  -->
<hr>


<div class="footer">
	Copyright &copy; 2013 - 2020 <a href="http://ssdb.io/">ssdb.io</a>. All rights reserved.
	Updated: 2020-12-17 00:52:57 +0000	</div>

</div> <!-- /container -->

<script src="./../js/jquery-1.9.1.min.js"></script>
<script src="./../js/bootstrap.min.js"></script>

</body>
</html>
